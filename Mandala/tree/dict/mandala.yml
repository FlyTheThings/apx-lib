name: mandala
title: Mandala
descr: Vehicle core data manager and data structure.

# Parameters:
#
# name:   short name of class/struct
# title:  text title
# descr:   text description
# units:  text units of measure
# type:   data type
# prec:   number precision, decimal points
# suffix: make title from parent.title+suffix

# Parameters are inherited from parent by child fields

# Tree UID contains 4 levels of IDs (12 bits):
# 0000CCTSSSSMMMMM
#
#   4  classes      2 bits  [sns, ctr, state, cmd]
#   2  types        1 bit   [nav, env]
#   16 subsystems   4 bits
#   32 fields       5 bits

# Data flow:
#
#   |sensors|  ->  |state|  ->  |cmd|  ->  |ctr|
#   |-----estimators-----|
#                  |---navigators---|
#                               |--controllers-|
#                  |---------telemetry---------|
#                               |----uplink----|

# config for parsers
uid_base: 0x1000
uid_bits:
  - 2
  - 1
  - 4
  - 5

inheritance:
  - type
  - prec
  - units

# defaults:
type: float
prec: 2

# 4 classes
content:
  - name: sns
    title: Sensors
    descr: Read only data sources, measured by sensors from physical parameters.
      Used as inputs to estimators. Never sent through telemetry stream.
    content:
      - name: nav
        content: sns-nav
        title: Navigation
        descr: Sensors used for vehicle navigation and controls.
          Used as input for position and attitude estimators and
          for filters to supply aerodynamic controls.

      - name: env
        content: sns-env
        title: Environment
        descr: Environmental sensors.
          Data used as inputs for filters to estimate vehicle state
          and safety conditions.

  - name: ctr
    title: Controls
    descr: Controls for vehicle drives and servos.
      Published by regulators.
    content:
      - name: nav
        content: ctr-nav
        title: Navigation
        descr: Controls used for vehicle stabilization.
          Data published by controllers for aerodynamic controls.

      - name: env
        content: ctr-env
        title: Environment
        descr: Environmental controls.
          Data generated by internal logic or uplink from GCS.

  - name: state
    title: State
    descr: Current vehicle state.
      Estimated values of sensors and current navigator status.
    content:
      - name: nav
        content: state-nav
        title: Navigation
        descr: Estimated data used for vehicle regulators.
          Filtered sensor data.

      - name: env
        content: state-env
        title: Environment
        descr: Processed data of current vehicle conditions.
          Can be overriden by GCS uplink.

  - name: cmd
    title: Commands
    descr: Commanded values.
      Received from the GCS or provided by navigator as commands for
      regulators.
    content:
      - name: nav
        content: cmd-nav
        title: Navigation
        descr: Commanded values generated by controllers.

      - name: env
        content: cmd-env
        title: System data identifiers
        descr: Special protocols and data wrappers.
        type: byte # void

streams:
  - name: v9_sd
    title: Standard v9.xx telemetry
    content:
      - state.nav.att.roll: f2
      - state.nav.att.pitch: f2
      - state.nav.att.yaw: f2
      - state.nav.pos.ax: f1_s
      - state.nav.pos.ay: f1_s
      - state.nav.pos.az: f1_s
      - state.nav.att.p: f1_s10
      - state.nav.att.q: f1_s10
      - state.nav.att.r: f1_s10
